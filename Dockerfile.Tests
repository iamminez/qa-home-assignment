# Use the .NET SDK image for building and testing
FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build

# Set working directory
WORKDIR /app

# Copy the solution and all project files
COPY . ./

# Restore dependencies for the entire solution
RUN dotnet restore

# Ensure TestResults directory exists
RUN mkdir -p /app/TestResults

# Run xUnit Unit Tests
RUN dotnet test Tests/CardValidation.Tests/CardValidation.Tests.Unit.csproj \
    --logger "trx;LogFileName=unit-tests.trx" \
    --results-directory /app/TestResults

# Run Reqnroll Integration Tests
RUN dotnet test Tests/CardValidation.Tests.Integration/CardValidation.Tests.Integration.csproj \
    --logger "trx;LogFileName=integration-tests.trx" \
    --results-directory /app/TestResults
